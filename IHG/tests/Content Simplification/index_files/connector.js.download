window.CopterConnect={_connectorVersion:"1.50",_baseUrl:"//www.roomkey.com/referrals",_apiVersion:"1.5.1",_datePattern:/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,_pu:null,schema:{type:"object",properties:{location:{type:"string",maxLength:"64"},state:{type:"string",minLength:"2",maxLength:"2",description:"State must be a 2-character code."},country:{type:"string",maxLength:"2",description:"Country must be a 2-character code (ISO 3166-1 alpha-2)"},lat:{type:"number",minimum:"-90",maximum:"90",dependencies:"lng"},lng:{type:"number",minimum:"-180",maximum:"180",dependencies:"lat"},property_id:{type:"string",maxLength:"64"},property_url:{type:"string",description:"A url back to the desired property booking page on the hotel brand's website. This should include dates and other search criteria as required.",dependencies:["property_id"]},displayed_lowest_nightly_rate:{type:"integer",minimum:"0",dependencies:["property_id","displayed_lowest_nightly_rate_room_type","currency"]},displayed_lowest_nightly_rate_room_type:{type:"string","enum":["suite","king","queen","standard","single/twin","double","other"],dependencies:["property_id","displayed_lowest_nightly_rate"]},check_in:{type:"string",format:"date",description:"Check-in must be in format yyyy-mm-dd",dependencies:["check_out","rooms","guests"]},check_out:{type:"string",format:"date",description:"Check-out must be in format yyyy-mm-dd",dependencies:["check_in","rooms","guests"]},rooms:{type:"integer",minimum:"1",maximum:"4"},guests:{type:"integer",minimum:"1",maximum:"16"},price_from:{type:"integer",minimum:"0",dependencies:["price_to","currency"]},price_to:{type:"integer",minimum:"0",dependencies:["price_from","currency"]},star_from:{type:"integer",minimum:"1",maximum:"5",dependencies:"star_from"},star_to:{type:"integer",minimum:"1",maximum:"5",dependencies:"star_to"},brand:{type:"array",items:{type:"string"},description:"An array of brand IDs indicating the brands in which the user is interested. For single brands a string can be provided instead of an array. A pipe-delimited string is also acceptable instead of an array."},amenities:{type:"array",items:{type:"string","enum":["INT","PETS","PKG","FIT","POOL","BUSIN","REST"]},description:"An array of amenity IDs. For single amenities a string can be provided instead of an array. A pipe-delimited string is also acceptable instead of an array."},currency:{type:"string",minLength:"3",maxLength:"3",description:"Currency must be a 3-character code (ISO 4217). If invalid or not supplied, currency is determined by the default currency of the Room Key TLD (see tld)."},language:{type:"string",minLength:"2",maxLength:"2",description:"Language must be a 2-character code (ISO 639-1)."},source_page:{type:"string",maxLength:"256"},visitor_type:{type:"string",maxLength:"128"},custom_data:{type:"string",maxLength:"128"},logo_url:{type:"string",description:"A URL to the hotel brand's logo."},domain:{type:"string",description:"The root domain of the page that is opening the pop-under. Used for setting cookie. Acceptable values 'hotelbrand.com', 'hotelbrand.co.uk'. Bad values: 'www.hotelbrand.com', 'www.hotelbrand.co.uk'. If omitted, assumes that domain is top-level and second-level elements. Therefore by default .com domains will set the cookie correctly but .co.uk domains will not and must be specified using this option."},window_name:{type:"string",description:"A name given to the pop-under window. The name should only contain alphanumeric characters. If omitted, this name is allocated automatically. This should only be used where windows are being opened and closed across different domains."},tld:{type:"string",description:"The desired top level domain of the Room Key pop-under. Must match one of those enumerated. Defaults to 'com' if not supplied. [Deprecated as of version 1.0.20. Use 'locale' instead].","enum":["com","uk","au","nz","ca"]},locale:{type:"string",description:"A locale string. This will determine the country-version of the Room Key site and the currency displayed in the interstitial experience. If the 'currency' option is set, this will override the currency associated with the locale. Examples: en-US, en-GB, en_US, en_GB. Unrecognised locale strings will default to 'en-US'.",maxLength:"10"},window_url:{type:"string",format:"url",description:"By default, the URL loaded into the pop-under window is that of the Room Key interstitial. However it may be desirable to open a different URL in the window which then subsequently redirects to the Room Key interstitial URL. This URL could be used to more reliably record metrics. If a window_url value is provided, it will have a querystring parameter of redirect_url appended to it."},allow_tab_under:{type:"string",description:"If set to 'true', browsers that do not support a pop-under but do support a tab-under e.g. Chrome v30+, will open a tab-under. Note that unlike pop-unders, tab-unders cannot be closed using CopterConnect.unload."}}},load:function(a,b){b||(b={});var c,d=!1,e=this._getCookieImpressionId()||this._uuid(),f=b.domain,g=b.allow_tab_under&&"true"===b.allow_tab_under,h=(b.window_name&&b.window_name.length>0?b.window_name:e).replace(/[\W_]/g,""),i=this._buildUrl(a,b,e);return this._apiKey=a,this._isSupportedBrowser()&&this._cookiesEnabled()&&(this._setCookie(e,a,h,f),c=this._pu=this._open(i,h,g),c&&(d=!0)),d},_buildUrl:function(a,b,c){var d="redirect_url",e=this._baseUrl,f=b.window_url,g=this._buildQueryString(a,b,c),h=e+"?"+g;return f&&(0===h.indexOf("//")&&(h=location.protocol+h),f+=f.indexOf("?")>=0?"&":"?",f+=d+"="+encodeURIComponent(h),h=f),h},_buildQueryString:function(a,b,c){var d,e="api_version="+this._apiVersion;if(this._validateApiKey(a),e+="&api_key="+encodeURI(a),e+="&impression_id="+encodeURI(c),e+="&referrer_hostname="+encodeURI(window.location.hostname),e+="&referral_method=connector",b){delete b.domain,delete b.window_name,delete b.window_url,delete b.allow_tab_under,b=this._removeEmptyOptions(b),this._options=b;for(d in b){if(!this.schema.properties[d])throw new this._connectorException(d+" is not a permitted option");this._validateOption(d,b[d],this.schema.properties[d]),this.schema.properties[d]&&"array"===this.schema.properties[d].type&&this._isArray(b[d])&&(b[d]=b[d].join("|")),e+="&"+d+"="+encodeURI(b[d].toString())}this._validateRanges()}return e},_removeEmptyOptions:function(a){var b;for(b in a)a[b]&&0!==a[b].length||delete a[b];return a},_windowOptions:function(){var a=this._dimensions();return"width="+a.w+",height="+a.h+",toolbar=1,menubar=1,resizable=1,location=1,scrollbars=1"},_open:function(a,b,c,d){var e=this._windowOptions(),f=!d&&this._useSafariTechnique()?this._openSafariSpecial(a,b,e):this._openStandard(a,b,e,c,d);return f},_openSafariSpecial:function(a,b,c){var d;return this._windowOpen("javascript:void window.focus()","_self",""),d=this._windowOpen(a,b,c)},_openStandard:function(a,b,c,d,e){var f=this._isTabUnderBrowser(),g=d&&this._canDoTabUnder();return g?this._openTabUnder(a):f?void 0:this._openPopUnder(a,b,c,e)},_openTabUnder:function(a){return this._openTab(a),this._cookie("CopterConnectTab","true"),!0},_openPopUnder:function(a,b,c,d){var e=this,f=this._browserSimpleDetect(),g=this._parent(),h=g.window.open(a,b,c);if(h)try{window.CopterConnect.popunder=h,this._switchFocus(h),!d&&f.firefox&&this._openCloseWindow(),!d&&f.webkit&&this._openTab(),f.msie&&setTimeout(function(){e._switchFocus(h)},1e3)}catch(i){}return h},_switchFocus:function(a){this._isIE11()?document.focus():(a.blur(),a.opener.window.focus(),window.self.window.focus(),window.focus())},_openCloseWindow:function(){var a=this._windowOpen("about:blank");a.focus(),a.close()},_openTab:function(a){var b,c="",d=a||"data:text/html,<scr"+c+"ipt>window.close();</scr"+c+"ipt>",e=!a,f=this._documentCreateElement("a");f.href=d,this._documentGetElementsByTagName("body")[0].appendChild(f),e=a?!e:e,b=this._documentCreateEvent("MouseEvents"),b.initMouseEvent.apply(b,this._tabUnderMouseEventArgs({type:"click",canBubble:!0,cancelable:!0,view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:e,altKey:!1,shiftKey:!e,metaKey:e,button:0,relatedTarget:null})),f.dispatchEvent(b),f.parentNode.removeChild(f)},_tabUnderOverrideArgs:function(a){return a},_tabUnderMouseEventArgs:function(a){return a=this._tabUnderOverrideArgs(a),[a.type,a.canBubble,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget]},_windowOpen:function(){return window.open.apply(window,arguments)},_documentCreateElement:function(){return document.createElement.apply(document,arguments)},_documentCreateEvent:function(){return document.createEvent.apply(document,arguments)},_documentGetElementsByTagName:function(){return document.getElementsByTagName.apply(document,arguments)},_parent:function(){return top!==self&&"string"==typeof top.document.location.toString()?top:self},_canDoTabUnder:function(){return this._cookiesEnabled()&&!this._cookie("CopterConnectTab")&&this._isTabUnderBrowser()},unload:function(a){var b,c,d=!1,e=this._getCookieImpressionId(),f=this._getCookieApiKey();if(a&&a.closeReason&&a.closeReason.length>15)throw new this._connectorException("The closeReason option must be 15 characters or fewer");return b=a&&"string"==typeof a?a:a&&a.windowName?a.windowName:this._getCookieWindowName(),b&&(c=this._pu||this._open("about:blank",b,!1,!0),c&&c.close&&(c&&c.close(),this._pu=null,this._removeCookie(),this._trackClose(e,f,a),d=!0)),d},_trackClose:function(a,b,c){var d;a&&(d=this._baseUrl.concat("/close/",a,"?api_key=",b,"&api_version=",this._apiVersion),c&&"object"==typeof c&&(d+="&count_impression="+!!c.countImpression,c.closeReason&&(d+="&close_reason="+encodeURIComponent(c.closeReason))),this._createTrackingPixel(d))},_createTrackingPixel:function(a){var b=new Image;b.src=a},_validateApiKey:function(a){if(!a)throw new this._connectorException("Missing API key");if(0===a.length)throw new this._connectorException("API key is an empty string")},_validateOption:function(a,b,c){this._validateDependencies(a,c),this._validateTypes(a,b,c),this._validateEnums(a,b,c),this._validatePatternAndFormat(a,b,c)},_validateDependencies:function(a,b){var c;if(b.dependencies)for("string"==typeof b.dependencies&&(b.dependencies=[b.dependencies]),c=0;c<b.dependencies.length;c++)if(!this._options[b.dependencies[c]])throw new this._connectorException(a+" depends on missing option "+b.dependencies[c])},_validateTypes:function(a,b,c){switch(c.type){case"string":this._validateString(a,b,c);break;case"number":this._validateNumber(a,b,c);break;case"integer":this._validateInteger(a,b,c);break;case"array":this._validateArray(a,b,c)}},_validateString:function(a,b,c){if(b.length<c.minLength)throw new this._connectorException(c.description||a+" must not contain fewer than "+c.minLength+" characters");if(b.length>c.maxLength)throw new this._connectorException(c.description||a+" must not exceed "+c.maxLength+" characters")},_validateNumber:function(a,b,c){if(isNaN(b))throw new this._connectorException(c.description||a+" must be a numeric value");if(c.minimum&&parseFloat(b)<parseFloat(c.minimum))throw new this._connectorException(c.description||a+" cannot be less than "+c.minimum);if(c.maximum&&parseFloat(b)>parseFloat(c.maximum))throw new this._connectorException(c.description||a+" cannot be greater than "+c.maximum)},_validateInteger:function(a,b,c){if(this._validateNumber(a,b,c),Math.ceil(b)!==Math.floor(b))throw new this._connectorException(c.description||a+" must be an integer")},_validateArray:function(a,b,c){var d;for(this._isArray(b)||(b=b.toString().split("|")),d=0;d<b.length;d++)this._validateOption(a,b[d],c.items)},_validateEnums:function(a,b,c){if(c["enum"]&&!this._inArray(c["enum"],b))throw new this._connectorException(c.description||'"'+b+'" is an invalid '+a+" value. Accepted values: "+c["enum"].join(", "))},_validatePatternAndFormat:function(a,b,c){var d=c.pattern||null;if("date"===c.format&&(d=this._datePattern),d&&!d.test(b))throw new this._connectorException(c.description||a+" failed regexp test")},_validateRanges:function(){var a,b=this._options;if(b.check_in&&b.check_out){var c=new Date(b.check_in.replace(/-/g,"/")),d=new Date(b.check_out.replace(/-/g,"/"));if(c>=d)throw new this._connectorException("Invalid check_out date. Must occur after check_in date.")}var e,f,g=["price","star"];for(a=0;a<g.length;a++)if(e=b[g[a]+"_from"],f=b[g[a]+"_to"],e&&f&&parseFloat(f)<parseFloat(e))throw new this._connectorException(g[a]+"_to cannot be less than "+g[a]+"_from")},_connectorException:function(a){this.message=a,this.name="ConnectorException"},_dimensions:function(){return{w:(window.innerWidth||1020)-30,h:(window.innerHeight||630)-30}},_uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}).toUpperCase()},_cookie:function(a,b,c){var d,e=this;if("undefined"==typeof b){var f=null;if(document.cookie&&""!==document.cookie){var g=document.cookie.split(";");for(d=0;d<g.length;d++){var h=e._trim(g[d]);if(h.substring(0,a.length+1)===a+"="){f=decodeURIComponent(h.substring(a.length+1));break}}}return f}c=c||{},null===b&&(b="",c.expires=-1);var i="";if(c.expires&&("number"==typeof c.expires||c.expires.toUTCString)){var j;"number"==typeof c.expires?(j=new Date,j.setTime(j.getTime()+24*c.expires*60*60*1e3)):j=c.expires,i="; expires="+j.toUTCString()}var k=c.path?"; path="+c.path:"",l=c.domain&&".localhost"!==c.domain?"; domain="+c.domain:"",m=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),i,k,l,m].join("")},_setCookie:function(a,b,c,d){d&&0!==d.length||(d=document.domain.split(".").slice(-2).join(".")),this._cookie("CopterConnect",[a,b,c].join("|"),{domain:"."+d,path:"/"})},_removeCookie:function(){this._cookie("CopterConnect","",{expires:-1})},_getCookie:function(){return this._cookie("CopterConnect")},_getCookieImpressionId:function(){var a=this._getCookie(),b=a?a=a.split("|")[0]:null;return b},_getCookieApiKey:function(){var a=this._getCookie(),b=a?a=a.split("|")[1]:null;return b},_getCookieWindowName:function(){var a=this._getCookie(),b=a?a=a.split("|")[2]:null;return b},_cookiesEnabled:function(){return navigator.cookieEnabled},_trim:function(a){a=a.replace(/^\s\s*/,"");for(var b=/\s/,c=a.length;b.test(a.charAt(--c)););return a.slice(0,c+1)},_inArray:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1},_isArray:function(a){return a.constructor.toString().indexOf("Array")>=0},_browserSimpleDetect:function(){var a=navigator.userAgent.toLowerCase(),b={webkit:/webkit/.test(a),firefox:/firefox/.test(a),msie:/msie/.test(a)&&!/opera/.test(a)};return b},_browserVersion:function(){var a,b=navigator.appName,c=navigator.userAgent,d=c.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return d&&null!=(a=c.match(/version\/([\.\d]+)/i))&&(d[2]=a[1]),d=d?[d[1],d[2]]:[b,navigator.appVersion,"-?"]},_isMobile:function(){var a=/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop|Silk/i;return!!navigator.userAgent.match(a)},_isUnsupportedIE:function(){var a,b=this._browserVersion();return"msie"===b[0].toLowerCase()&&(a=parseInt(b[1].split(".")[0]),9>a)?!0:!1},_isIE11:function(){return/Trident\/7\./.test(navigator.userAgent)},_isEdge:function(){return/Edge\/12/.test(navigator.userAgent)},_isTabUnderBrowser:function(){var a,b,c=this._browserVersion(),d=!1;return"chrome"===c[0].toLowerCase()&&(a=c[1].split("."),b=parseInt(a[0],10),b>=30&&41>b&&(d=!0)),d},_isBot:function(){return!!navigator.userAgent.match(/GomezAgent/i)},_useSafariTechnique:function(){var a=this._browserVersion();return"safari"===a[0].toLowerCase()&&-1===this._compareVersionNumbers(a[1],"6.1.1")&&this._compareVersionNumbers(a[1],"6")>=0?!0:!1},_isPositiveInteger:function(a){return/^\d+$/.test(a)},_isFullScreen:function(){return window.outerWidth===screen.width&&window.outerHeight===screen.height},_macOSXVersion:function(){var a=navigator.userAgent.toLowerCase(),b=a.match(/mac os x (\d+)_(\d+)+/);return b||(b=a.match(/mac os x (\d+)[.](\d+)+/)),b?parseInt(b[2]):void 0},_compareVersionNumbers:function(a,b){function c(a){for(var b=0;b<a.length;++b)if(!d._isPositiveInteger(a[b]))return!1;return!0}var d=this,e=a.split("."),f=b.split(".");if(!c(e)||!c(f))return 0/0;for(var g=0;g<e.length;++g){if(f.length===g)return 1;if(e[g]!==f[g])return e[g]>f[g]?1:-1}return e.length!==f.length?-1:0},_isSupportedBrowser:function(){var a,b=this._browserVersion(),c=this._macOSXVersion();return this._isMobile()?!1:this._isBot()?!1:"chrome"===b[0].toLowerCase()&&(a=b[1].split("."),parseInt(a[0])>=41)?!1:this._isUnsupportedIE()?!1:this._isEdge()?!1:c&&c>=10&&this._isFullScreen()&&!this._isTabUnderBrowser()?!1:!0}};